@{
    ViewBag.Title = "Add Cost Approver Group";
    ViewBag.pTitle = "Cost Approver Group";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <link rel="stylesheet" href="~/assets/css/components/searchable-dropdown.css">
    <style>
        .required-field::after {
            content: " *";
            color: #dc3545;
        }

        .form-section {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075);
        }

        [data-pc-theme="dark"] .form-section {
            background: #2d3748;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        [data-pc-theme="dark"] .section-title {
            color: #e5e7eb;
            border-bottom-color: #4a5568;
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        [data-pc-theme="dark"] .form-label {
            color: #cbd5e0;
        }

        .form-label .required {
            color: #dc3545;
            margin-left: 0.25rem;
        }

        .approval-flow-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        [data-pc-theme="dark"] .approval-flow-card {
            background: #374151;
            border-color: #4a5568;
        }

        .approval-flow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .approval-flow-name {
            font-weight: 600;
            font-size: 1rem;
            color: #2c3e50;
        }

        [data-pc-theme="dark"] .approval-flow-name {
            color: #e5e7eb;
        }

        .approver-section {
            background: white;
            border-radius: 0.25rem;
            padding: 0.75rem;
        }

        [data-pc-theme="dark"] .approver-section {
            background: #2d3748;
        }

        .approver-table {
            width: 100%;
        }

        .approver-table thead {
            background: #e9ecef;
        }

        [data-pc-theme="dark"] .approver-table thead {
            background: #374151;
        }

        .approver-table th {
            padding: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #495057;
        }

        [data-pc-theme="dark"] .approver-table th {
            color: #cbd5e0;
        }

        .approver-table td {
            padding: 0.5rem;
            vertical-align: middle;
        }

        .approver-row {
            border-bottom: 1px solid #e9ecef;
        }

        [data-pc-theme="dark"] .approver-row {
            border-bottom-color: #4a5568;
        }

        .approver-name {
            font-weight: 500;
            color: #2c3e50;
        }

        [data-pc-theme="dark"] .approver-name {
            color: #e5e7eb;
        }

        .authority-level {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #667eea;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
        }

        .properties-grid,
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }

        [data-pc-theme="dark"] .properties-grid,
        [data-pc-theme="dark"] .categories-grid {
            border-color: #4a5568;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.25rem;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem;
        }

        .checkbox-item label {
            margin-bottom: 0;
            cursor: pointer;
            user-select: none;
        }

        [data-pc-theme="dark"] .checkbox-item label {
            color: #cbd5e0;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            padding-right: 2.5rem;
        }

        .search-bar .clear-search {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
        }

        .empty-approvers {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        [data-pc-theme="dark"] .empty-approvers {
            color: #9ca3af;
        }

        .priority-badge {
            display: inline-block;
            background-color: #667eea;
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-left: 0.25rem;
        }

        .clickable-approver {
            cursor: pointer;
            transition: color 0.2s;
        }

        .clickable-approver:hover {
            color: #667eea;
            text-decoration: underline;
        }
    </style>
}

<div class="row">
    <div class="col-sm-12">
        <div class="page-header-title mb-3">
            <h4 class="mb-2">
                <i class="ti ti-plus me-2"></i>New Cost Approver Group
            </h4>
            <p class="text-muted mb-3">Create a new cost approver group for work request approvals</p>
            <div>
                <a href="/Helpdesk/CostApprover" class="btn btn-light btn-sm">
                    <i class="ti ti-arrow-left me-1"></i>
                    Back to List
                </a>
            </div>
        </div>

        <form id="costApproverForm">
            <!-- Basic Information Section -->
            <div class="form-section">
                <h5 class="section-title">Basic Information</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Cost Approver Group Name
                            <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="groupName" name="groupName" placeholder="Enter cost approver group name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter description..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Range Value Section -->
            <div class="form-section">
                <h5 class="section-title">Range Value <span class="required">*</span></h5>
                <div class="row align-items-end">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Currency</label>
                        <select class="form-select"
                                id="currency"
                                name="currency"
                                data-searchable="true"
                                data-placeholder="Select Currency"
                                data-search-placeholder="Search currency...">
                            <option value="">Select Currency</option>
                            <option value="IDR">IDR</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Minimum Value</label>
                        <input type="number" class="form-control" id="minValue" name="minValue" placeholder="0.00" step="0.01" value="0.00">
                    </div>
                    <div class="col-md-1 mb-3 text-center">
                        <span>-</span>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Maximum Value</label>
                        <input type="number" class="form-control" id="maxValue" name="maxValue" placeholder="0.00" step="0.01" value="0.00">
                    </div>
                </div>
            </div>

            <!-- Coverage Property Section -->
            <div class="form-section">
                <h5 class="section-title">Coverage Property <span class="required">*</span></h5>
                <div class="mb-2">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllProperties">
                        <label class="form-check-label" for="selectAllProperties">
                            <strong>Select All Properties</strong>
                        </label>
                    </div>
                </div>
                <div class="properties-grid" id="propertiesGrid">
                    <!-- Properties will be loaded here -->
                </div>
            </div>

            <!-- Work Category Section -->
            <div class="form-section">
                <h5 class="section-title">Work Category <span class="required">*</span></h5>
                <div class="mb-2">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllCategories">
                        <label class="form-check-label" for="selectAllCategories">
                            <strong>Select All Work Categories</strong>
                        </label>
                    </div>
                </div>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Approval Flow Section -->
            <div class="form-section">
                <h5 class="section-title">Approval Flow <span class="required">*</span></h5>
                <button type="button" class="btn btn-primary btn-sm mb-3" id="addApprovalFlowBtn">
                    <i class="ti ti-plus me-1"></i>
                    Add New Approval Flow
                </button>
                <div id="approvalFlowsContainer">
                    <!-- Approval flows will be added here -->
                </div>
            </div>

            <!-- Actions -->
            <div class="form-section">
                <div class="d-flex justify-content-end gap-2">
                    <a href="/Helpdesk/CostApprover" class="btn btn-secondary">
                        <i class="ti ti-x me-1"></i>
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="ti ti-device-floppy me-1"></i>
                        Save Cost Approver Group
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Add Approval Flow Modal -->
<div class="modal fade" id="approvalFlowModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Approval Flow</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">
                        Approval Flow Name
                        <span class="required">*</span>
                    </label>
                    <input type="text" class="form-control" id="approvalFlowName" placeholder='Type the Approval Flow name here, e.g. "Electricity, HVAC"'>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="ti ti-x me-1"></i>
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" id="saveApprovalFlowBtn">
                    <i class="ti ti-device-floppy me-1"></i>
                    Save
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Approver Modal -->
<div class="modal fade" id="approverModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Approver</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <label class="form-label">Search Approver</label>
                        <input type="text" class="form-control" id="approverSearch" placeholder="Search...">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Select Approver</label>
                        <select class="form-select"
                                id="approverSelect"
                                data-searchable="true"
                                data-placeholder="Select an approver..."
                                data-search-placeholder="Search approver...">
                            <option value="">Select an approver...</option>
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="button" class="btn btn-primary btn-icon" id="addApproverToListBtn" title="Add Approver">
                            <i class="ti ti-plus"></i>
                        </button>
                    </div>
                </div>

                <div class="mb-3">
                    <table class="table table-sm approver-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Is Priority Approver?</th>
                                <th width="50">Action</th>
                            </tr>
                        </thead>
                        <tbody id="approverTableBody">
                            <tr class="empty-approvers">
                                <td colspan="3">No Approver</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="ti ti-x me-1"></i>
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" id="saveApproversBtn">
                    <i class="ti ti-device-floppy me-1"></i>
                    Save New Approver
                </button>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/assets/js/components/searchable-dropdown.js"></script>
    <script src="~/assets/js/pages/settings/cost-approver-add.js"></script>
}
