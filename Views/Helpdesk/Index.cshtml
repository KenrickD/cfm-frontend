@{
    ViewBag.Title = "Work Request Management";
    ViewBag.pTitle = "Helpdesk";
    ViewBag.cTitle = "List of Work Request";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <link href="~/assets/css/plugins/animate.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="~/assets/css/uikit.css">

    <style>
        .modal-footer.no-divider {
            border-top: none;
        }

        .modal-header.no-divider {
            border-bottom: none;
        }
    </style>
}

<div class="row">
    <!-- [ sample-page ] start -->
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <h5>@ViewBag.cTitle</h5>
                <p>This table shows all work requests with their codes, titles, requestors, and related details.</p>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <div class="grid gap-0 column-gap-2 d-flex flex-row" style="100%">
                        <div class="input-group w-100" style="border-color: #DBE0E5;">
                            <input placeholder="Search by entering keywords for Work Request Code, Work Title, or Requestor ..."
                                   type="text" class="form-control">
                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                    data-bs-content="Search" data-bs-trigger="hover">
                                <i class="ti ti-search"></i>
                            </button>
                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-toggle="collapse" data-bs-target="#advancedSearch" aria-expanded="false"
                                    aria-controls="advancedSearch" id="advancedSearchPopover">
                                <i class="ti ti-list-search"></i>
                            </button>
                            <button type="button" class="btn btn-light dropdown-toggle d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-toggle="dropdown" aria-expanded="false" id="downloadDropdownPopover">
                                <i class="ti ti-cloud-download"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Download as Excel</a></li>
                                <li><a class="dropdown-item" href="#">Download for Updating in Exodus</a></li>
                            </ul>

                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                    data-bs-content="Send Summary" data-bs-trigger="hover">
                                <i class="ti ti-mail-forward"></i>
                            </button>
                            <a href="/helpdesk/work-requests/add" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                               data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                               data-bs-content="Add New Work Request" data-bs-trigger="hover">
                                <i class="ti ti-plus"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="collapse" id="advancedSearch">
                    <div class="card card-body shadow-none">
                        <form>
                            <div class="row">
                                <div class="col-md-4">

                                    <div class="mb-3">
                                        @model cfm_frontend.ViewModels.WorkRequestViewModel
                                        <label class="form-label text-primary font-weight-bold" for="propertyGroupSelect">Property Group</label>
                                        <select class="form-select form-select-sm" id="propertyGroupSelect">
                                            <option value="">All</option>
                                            @if(Model.PropertyGroups != null)
                                            {
                                                @foreach (var group in Model.PropertyGroups)
                                                {
                                                    <option value="@group.propertyGroupId">@group.propertyGroupName</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="mb-3" style="overflow: auto; max-height: 400px;">
                                        <label class="form-label text-primary font-weight-bold">Location</label>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" value="" id="checkbox1">
                                            <label class="form-check-label text-sm" for="checkbox1">
                                                Central Petroleum Tower II
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" value="" id="checkbox2">
                                            <label class="form-check-label text-sm" for="checkbox2">
                                                Giant Fatmawati
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3" style="overflow: auto; max-height: 400px;">
                                        <label class="form-label text-primary font-weight-bold">Status</label>
                                        @if(Model.Status != null)
                                        {
                                            @foreach (var status in Model.Status)
                                            {
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" value="" id="@status.status">
                                                    <label class="form-check-label text-sm" for="checkbox1">
                                                        @status.status
                                                    </label>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="simpletable" class="table nowrap table-hover m-x-0">
                        <thead>
                            <tr>
                                <th class="text-capitalize">Work Title</th>
                                <th class="text-capitalize">Requested by</th>
                                <th class="text-capitalize">Location</th>
                                <th class="text-capitalize">Work Category</th>
                                <th class="text-capitalize">Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if(Model.WorkRequest != null)
                            {
                                @foreach (var workRequest in Model.WorkRequest)
                                {
                                    var statusClass = "";
                                    switch (workRequest.status)
                                    {
                                        case "New":
                                            statusClass = "bg-light-primary";
                                            break;
                                        case "In Progress":
                                            statusClass = "bg-light-success";
                                            break;
                                        case "Completed":
                                            statusClass = "bg-light-secondary";
                                            break;
                                        default:
                                            statusClass = "bg-light"; // Fallback class if status doesn't match
                                            break;
                                    }
                                    <tr>
                                        <td>
                                            <div class="align-items-center text-wrap" style="width: 250px">
                                                <span>
                                                    <a href="work-requests/@workRequest.idWorkRequest">@workRequest.workRequestCode</a>
                                                    <span class="badge" style="background-color: @workRequest.plmColor;">@workRequest.plm</span>
                                                </span>
                                                <div>
                                                    <span>@workRequest.workTitle</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <a href="#!" data-bs-toggle="offcanvas"
                                                   data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                                                    Bayu Wilanda
                                                </a>
                                                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight"
                                                     aria-labelledby="offcanvasRightLabel">
                                                    <div class="offcanvas-header">
                                                        <h5 id="offcanvasRightLabel">Contact Detail</h5>
                                                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="offcanvas-body">
                                                        <div class="mt-3">
                                                            <div class="mb-3 col-md-12">
                                                                <div class="d-flex flex-row justify-content-between align-items-center">
                                                                    <h5 class="mb-3">Bayu Wilanda</h5>
                                                                    <a href="#" class="btn btn-light btn-sm" style="border-color: #DBE0E5;"
                                                                       data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                                                       data-bs-content="Edit contact" data-bs-trigger="hover">
                                                                        <i class="ti ti-edit"></i>
                                                                        <span class="ml-1 text-sm">Edit</span>
                                                                    </a>
                                                                </div>
                                                            </div>

                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Phone</label>
                                                                <div>
                                                                    +62 813-9850-5188
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="+62 813-9850-5188"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                            </div>

                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Email</label>
                                                                <div>
                                                                    bayuwilanda@gmail.com <span class="fw-semibold">(Main)</span>
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="bayuwilanda@gmail.com"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                                <div>
                                                                    muhamadbayuwilanda@gmail.com
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="muhamadbayuwilanda@gmail.com"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                            </div>

                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Department</label>
                                                                <div>
                                                                    IT Software Development
                                                                </div>
                                                            </div>

                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Role</label>
                                                                <div>
                                                                    Tukang
                                                                </div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Notes</label>
                                                                <div>
                                                                    -
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <p>On @workRequest.requestDate</p>
                                        </td>
                                        <td>
                                            <div class="d-flex flex-column" style="width: 200px">
                                                <span class="text-wrap">@workRequest.locationFinal</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex flex-column">
                                                <span>@workRequest.workCategory</span>
                                                <span>Service Provider: Self-Performed</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge @statusClass">@workRequest.status</span>
                                        </td>
                                        <td>
                                            <div class="grid gap-0 column-gap-2 d-flex flex-row">
                                                <a class="btn btn-light btn-sm" href="#" role="button" data-bs-container="body"
                                                   data-bs-toggle="popover" data-bs-placement="top"
                                                   data-bs-content="Edit this Work Request" data-bs-trigger="hover">
                                                    <i class="ti ti-edit-circle"></i>
                                                </a>
                                                <button data-pc-animate="blur" type="button" class="btn btn-light btn-sm" data-bs-toggle="modal"
                                                        data-bs-target="#deleteModal">
                                                    <i class="ti ti-trash"></i>
                                                </button>
                                            </div>

                                        </td>
                                    </tr>

                                }
                             }
                        </tbody>
                    </table>
                </div>

                <nav aria-label="Pagination" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">
                                    <i class="ti ti-chevron-left"></i>
                                    Previous
                                </span>
                            </a>
                        </li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item active"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">56</a></li>
                        <li class="page-item"><a class="page-link" href="#">57</a></li>
                        <li class="page-item"><a class="page-link" href="#">58</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">
                                    Next
                                    <i class="ti ti-chevron-right"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                </nav>



            </div>
        </div>
    </div>
    <!-- [ sample-page ] end -->
</div>

<div class="modal fade modal-animate" id="deleteModal" tabindex="-1"
     aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header no-divider">
                <div class="d-flex flex-row align-items-center text-danger">
                    <i class="ti ti-alert-octagon m-r-10" style="font-size: 20px"></i>
                    <span class="text-lg fw-semibold">Warning</span>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <h5>You are about to delete Work Request &mdash; WR-1234567</h5>
                <p>Are you sure you want to delete this Work Request? This action cannot be undone.</p>
            </div>

            <div class="modal-footer no-divider bg-gray-100">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-between gap-3">
                        <button type="button" class="btn btn-outline-secondary rounded-3 w-100 d-flex justify-content-center align-items-center" data-bs-dismiss="modal">
                            <i class="ti ti-x m-r-10"></i>
                            Cancel
                        </button>

                        <button type="button" class="btn btn-danger rounded-3 w-100 d-flex justify-content-center align-items-center">
                            <i class="ti ti-trash m-r-10"></i>
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    @* <script src="~/assets/js/plugins/clipboard.min.js"></script> *@
    <script>
        $(document).ready(function () {
            // new ClipboardJS('[data-clipboard=true]').on('success', function (e) {
            //     e.clearSelection();
            //     alert('Copied!');
            // });
            $('#advancedSearchPopover').popover({
                container: 'body',
                placement: 'top',
                content: 'Advanced Search',
                trigger: 'hover'
            });
            $('#downloadDropdownPopover').popover({
                container: 'body',
                placement: 'top',
                content: 'Download',
                trigger: 'hover'
            });
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        $(document).ready(function () {
            var deleteModal = $('#deleteModal');

            deleteModal.on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);  // Button that triggered the modal
                var recipient = button.data('pc-animate');  // Extract info from data-* attribute
                var modalTitle = deleteModal.find('.modal-title');

                modalTitle.text('Animate Modal: ' + recipient);
                deleteModal.addClass('anim-' + recipient);

                if (recipient == 'let-me-in' || recipient == 'make-way' || recipient == 'slip-from-top') {
                    $('body').addClass('anim-' + recipient);
                }
            });

            deleteModal.on('hidden.bs.modal', function () {
                removeClassByPrefix(deleteModal, 'anim-');
                removeClassByPrefix($('body'), 'anim-');
            });

            function removeClassByPrefix(node, prefix) {
                node.removeClass(function (index, className) {
                    return (className.match(new RegExp('\\b' + prefix + '\\S+', 'g')) || []).join(' ');
                });
            }
        });
    </script>
}
