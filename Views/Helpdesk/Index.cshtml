@model cfm_frontend.ViewModels.WorkRequestViewModel
@{
    ViewBag.Title = "Work Request Management";
    ViewBag.pTitle = "Helpdesk";
    ViewBag.cTitle = "List of Work Request";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <link href="~/assets/css/plugins/animate.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="~/assets/css/uikit.css">

    <style>
        .modal-footer.no-divider {
            border-top: none;
        }

        .modal-header.no-divider {
            border-bottom: none;
        }

        /* Filter Modal Styles */
        .filter-modal .modal-dialog {
            max-width: 900px;
        }

        .filter-section {
            margin-bottom: 25px;
        }

        .filter-section-title {
            font-weight: 600;
            font-size: 14px;
            color: #04a9f5;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-checkbox-group {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            background-color: #f8f9fa;
        }

        .filter-checkbox-item {
            margin-bottom: 10px;
        }

            .filter-checkbox-item:last-child {
                margin-bottom: 0;
            }

            .filter-checkbox-item .form-check-input {
                margin-top: 0.15em;
            }

            .filter-checkbox-item .form-check-label {
                font-size: 14px;
                cursor: pointer;
            }

        .filter-date-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

            .filter-date-group .form-label {
                min-width: 80px;
                margin-bottom: 0;
                font-weight: 500;
                font-size: 13px;
            }

            .filter-date-group .form-control {
                flex: 1;
            }

        .modal-body {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .btn-clear-filter {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
        }

            .btn-clear-filter:hover {
                background-color: #e2e6ea;
                border-color: #dae0e5;
                color: #545b62;
            }

        /* Pagination Styling */
        .pagination-info {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .pagination {
            margin: 0;
        }

            .pagination .page-link {
                border-radius: 6px;
                margin: 0 3px;
                border: 1px solid #dee2e6;
                color: #495057;
                min-width: 40px;
                text-align: center;
            }

            .pagination .page-item.active .page-link {
                background-color: #04a9f5;
                border-color: #04a9f5;
                color: white;
            }

            .pagination .page-item.disabled .page-link {
                background-color: #f8f9fa;
                border-color: #dee2e6;
                color: #6c757d;
            }

            .pagination .page-link:hover:not(.active) {
                background-color: #e9ecef;
                border-color: #dee2e6;
                color: #495057;
            }

            .pagination .page-ellipsis {
                padding: 0.375rem 0.75rem;
                margin: 0 3px;
                color: #6c757d;
            }
    </style>
}

<div class="row">
    <!-- [ sample-page ] start -->
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <h5>@ViewBag.cTitle</h5>
                <p>This table shows all work requests with their codes, titles, requestors, and related details.</p>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <div class="grid gap-0 column-gap-2 d-flex flex-row" style="width: 100%">
                        <div class="input-group w-100" style="border-color: #DBE0E5;">
                            <input placeholder="Search by entering keywords for Work Request Code, Work Title, or Requestor ..."
                                   type="text" class="form-control" id="mainSearchInput">
                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                    data-bs-content="Search" data-bs-trigger="hover" id="searchButton">
                                <i class="ti ti-search"></i>
                            </button>
                            <!-- Filter Button - Opens Modal -->
                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-toggle="modal" data-bs-target="#filterModal"
                                    data-bs-container="body" data-bs-original-title="Advanced Filters">
                                <i class="ti ti-filter"></i>
                            </button>
                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                    data-bs-content="Clear Search" data-bs-trigger="hover" id="clearSearchButton">
                                <i class="ti ti-list-search"></i>
                            </button>
                            <button type="button" class="btn btn-light dropdown-toggle d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-toggle="dropdown" aria-expanded="false" id="downloadDropdownPopover">
                                <i class="ti ti-cloud-download"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Download as Excel</a></li>
                                <li><a class="dropdown-item" href="#">Download for Updating in Exodus</a></li>
                            </ul>

                            <button type="button" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                                    data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                                    data-bs-content="Send Summary" data-bs-trigger="hover">
                                <i class="ti ti-mail-forward"></i>
                            </button>
                            <a href="/helpdesk/work-requests/add" class="btn btn-light d-flex flex-row align-items-center" style="border-color: #DBE0E5;"
                               data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top"
                               data-bs-content="Add New Work Request" data-bs-trigger="hover">
                                <i class="ti ti-plus"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table id="simpletable" class="table nowrap table-hover m-x-0">
                        <thead>
                            <tr>
                                <th class="text-capitalize">Work Title</th>
                                <th class="text-capitalize">Requested by</th>
                                <th class="text-capitalize">Location</th>
                                <th class="text-capitalize">Work Category</th>
                                <th class="text-capitalize">Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model?.WorkRequest != null && Model.WorkRequest.Any())
                            {
                                @foreach (var workRequest in Model.WorkRequest)
                                {
                                    var statusClass = "";
                                    switch (workRequest.status)
                                    {
                                        case "New":
                                            statusClass = "bg-light-primary";
                                            break;
                                        case "In Progress":
                                            statusClass = "bg-light-success";
                                            break;
                                        case "Completed":
                                            statusClass = "bg-light-secondary";
                                            break;
                                        default:
                                            statusClass = "bg-light";
                                            break;
                                    }
                                    <tr>
                                        <td>
                                            <div class="align-items-center text-wrap" style="width: 250px">
                                                <span>
                                                    <a href="work-requests/@workRequest.idWorkRequest">@workRequest.workRequestCode</a>
                                                    <span class="badge" style="background-color: @workRequest.plmColor;">@workRequest.plm</span>
                                                </span>
                                                <div>
                                                    <span>@workRequest.workTitle</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <a href="#!" uk-toggle="target: #requestorModal-@workRequest.idWorkRequest">
                                                    Bayu Wilanda
                                                </a>
                                            </div>
                                            <div id="requestorModal-@workRequest.idWorkRequest" uk-modal>
                                                <div class="uk-modal-dialog uk-modal-body">
                                                    <button class="uk-modal-close-default" type="button" uk-close></button>
                                                    <h2 class="uk-modal-title">Requestor Information</h2>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Name</label>
                                                                <div>Bayu Wilanda</div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Phone</label>
                                                                <div>
                                                                    +62 813-9850-5188
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="+62 813-9850-5188"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Email</label>
                                                                <div>
                                                                    bayuwilanda@gmail.com <span class="fw-semibold">(Main)</span>
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="bayuwilanda@gmail.com"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                                <div>
                                                                    muhamadbayuwilanda@gmail.com
                                                                    <a data-clipboard="true" role="button"
                                                                       data-clipboard-text="muhamadbayuwilanda@gmail.com"
                                                                       class="text-primary">
                                                                        <i class="ti ti-copy"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Department</label>
                                                                <div>IT Software Development</div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Role</label>
                                                                <div>Tukang</div>
                                                            </div>
                                                            <div class="mb-3 col-md-12">
                                                                <label class="form-label fw-semibold">Notes</label>
                                                                <div>-</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <p>On @workRequest.requestDate</p>
                                        </td>
                                        <td>
                                            <div class="d-flex flex-column" style="width: 200px">
                                                <span class="text-wrap">@workRequest.locationFinal</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex flex-column">
                                                <span>@workRequest.workCategory</span>
                                                <span>Service Provider: Self-Performed</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge @statusClass">@workRequest.status</span>
                                        </td>
                                        <td>
                                            <div class="grid gap-0 column-gap-2 d-flex flex-row">
                                                <a class="btn btn-light btn-sm" href="#" role="button" data-bs-container="body"
                                                   data-bs-toggle="popover" data-bs-placement="top"
                                                   data-bs-content="Edit this Work Request" data-bs-trigger="hover">
                                                    <i class="ti ti-edit-circle"></i>
                                                </a>
                                                <button data-pc-animate="blur" type="button" class="btn btn-light btn-sm" data-bs-toggle="modal"
                                                        data-bs-target="#deleteModal">
                                                    <i class="ti ti-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <div class="text-muted">
                                            <i class="ti ti-inbox" style="font-size: 48px;"></i>
                                            <p class="mt-2">No work requests found</p>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @* Dynamic Pagination *@
                @if (Model?.Paging != null && Model.Paging.TotalPages > 0)
                {
                    <div class="pagination-info">
                        Showing @((Model.Paging.CurrentPage - 1) * Model.Paging.PageSize + 1)
                        to @(Math.Min(Model.Paging.CurrentPage * Model.Paging.PageSize, Model.Paging.TotalRecords))
                        of @Model.Paging.TotalRecords work requests
                    </div>

                    <nav aria-label="Pagination" class="mt-4">
                        <ul class="pagination justify-content-center">
                            @* Previous Button *@
                            <li class="page-item @(!Model.Paging.HasPreviousPage ? "disabled" : "")">
                                @if (Model.Paging.HasPreviousPage)
                                {
                                    <a class="page-link" href="?page=@(Model.Paging.CurrentPage - 1)" aria-label="Previous">
                                        <span aria-hidden="true">
                                            <i class="ti ti-chevron-left"></i>
                                            Previous
                                        </span>
                                    </a>
                                }
                                else
                                {
                                    <span class="page-link">
                                        <span aria-hidden="true">
                                            <i class="ti ti-chevron-left"></i>
                                            Previous
                                        </span>
                                    </span>
                                }
                            </li>

                            @* Page Numbers *@
                            @foreach (var pageNumber in Model.Paging.GetPageNumbers())
                            {
                                if (pageNumber == -1)
                                {
                                    @* Ellipsis *@
                                    <li class="page-item disabled">
                                        <span class="page-ellipsis">...</span>
                                    </li>
                                }
                                else
                                {
                                    <li class="page-item @(pageNumber == Model.Paging.CurrentPage ? "active" : "")">
                                        <a class="page-link" href="?page=@pageNumber">@pageNumber</a>
                                    </li>
                                }
                            }

                            @* Next Button *@
                            <li class="page-item @(!Model.Paging.HasNextPage ? "disabled" : "")">
                                @if (Model.Paging.HasNextPage)
                                {
                                    <a class="page-link" href="?page=@(Model.Paging.CurrentPage + 1)" aria-label="Next">
                                        <span aria-hidden="true">
                                            Next
                                            <i class="ti ti-chevron-right"></i>
                                        </span>
                                    </a>
                                }
                                else
                                {
                                    <span class="page-link">
                                        <span aria-hidden="true">
                                            Next
                                            <i class="ti ti-chevron-right"></i>
                                        </span>
                                    </span>
                                }
                            </li>
                        </ul>
                    </nav>
                }
            </div>
        </div>
    </div>
    <!-- [ sample-page ] end -->
</div>

<!-- Filter Modal - DATA IS LOADED FROM SERVER (Model) -->
<div class="modal fade filter-modal" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">
                    <i class="ti ti-filter me-2"></i>Advanced Filters
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="filterForm">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            <!-- Property Group - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Property Group</label>
                                <select class="form-select" id="filterPropertyGroup" name="propertyGroup">
                                    <option value="">All</option>
                                    @if (Model?.PropertyGroups != null)
                                    {
                                        @foreach (var group in Model.PropertyGroups)
                                        {
                                            <option value="@group.propertyGroupId">@group.propertyGroupName</option>
                                        }
                                    }
                                </select>
                            </div>

                            <!-- Location - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Location</label>
                                <div class="filter-checkbox-group">
                                    @if (Model?.Locations != null && Model.Locations.Any())
                                    {
                                        @foreach (var location in Model.Locations)
                                        {
                                            <div class="filter-checkbox-item form-check">
                                                <input class="form-check-input" type="checkbox" value="@location.id" id="loc_@location.id" name="locations">
                                                <label class="form-check-label" for="loc_@location.id">
                                                    @location.name
                                                </label>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="text-center text-muted py-2">
                                            <small>No locations available</small>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Service Provider - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Service Provider</label>
                                <div class="filter-checkbox-group">
                                    @if (Model?.ServiceProviders != null && Model.ServiceProviders.Any())
                                    {
                                        @foreach (var provider in Model.ServiceProviders)
                                        {
                                            <div class="filter-checkbox-item form-check">
                                                <input class="form-check-input" type="checkbox" value="@provider.id" id="sp_@provider.id" name="serviceProviders">
                                                <label class="form-check-label" for="sp_@provider.id">
                                                    @provider.name
                                                </label>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="text-center text-muted py-2">
                                            <small>No service providers available</small>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Room Zone -->
                            <div class="filter-section">
                                <label class="filter-section-title">Room Zone</label>
                                <select class="form-select" id="filterRoomZone" name="roomZone">
                                    <option value="">All</option>
                                    <!-- Room zones can be added here if available in model -->
                                </select>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-6">
                            <!-- Work Category - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Work Category</label>
                                <div class="filter-checkbox-group">
                                    @if (Model?.WorkCategories != null && Model.WorkCategories.Any())
                                    {
                                        @foreach (var category in Model.WorkCategories)
                                        {
                                            <div class="filter-checkbox-item form-check">
                                                <input class="form-check-input" type="checkbox" value="@category.id" id="wc_@category.id" name="workCategories">
                                                <label class="form-check-label" for="wc_@category.id">
                                                    @category.name
                                                </label>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="text-center text-muted py-2">
                                            <small>No work categories available</small>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Other Category - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Other Category</label>
                                <div class="filter-checkbox-group">
                                    @if (Model?.OtherCategories != null && Model.OtherCategories.Any())
                                    {
                                        @foreach (var category in Model.OtherCategories)
                                        {
                                            <div class="filter-checkbox-item form-check">
                                                <input class="form-check-input" type="checkbox" value="@category.id" id="oc_@category.id" name="otherCategories">
                                                <label class="form-check-label" for="oc_@category.id">
                                                    @category.name
                                                </label>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="text-center text-muted py-2">
                                            <small>No other categories available</small>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Priority Level - STATIC -->
                            <div class="filter-section">
                                <label class="filter-section-title">Priority Level</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="high" id="priorityHigh" name="priorities">
                                        <label class="form-check-label" for="priorityHigh">High</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="high_with_cost" id="priorityHighCost" name="priorities">
                                        <label class="form-check-label" for="priorityHighCost">High With Cost</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="low" id="priorityLow" name="priorities">
                                        <label class="form-check-label" for="priorityLow">Low</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="medium" id="priorityMedium" name="priorities">
                                        <label class="form-check-label" for="priorityMedium">Medium</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="medium_with_cost" id="priorityMediumCost" name="priorities">
                                        <label class="form-check-label" for="priorityMediumCost">Medium With Cost</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="medium_with_cost_ready" id="priorityMediumCostReady" name="priorities">
                                        <label class="form-check-label" for="priorityMediumCostReady">Medium With Cost - Ready Stock - Ready Stoc assa8l4</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="test_priority" id="priorityTest" name="priorities">
                                        <label class="form-check-label" for="priorityTest">test priority</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Full Width Sections -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <!-- Status - FROM SERVER -->
                            <div class="filter-section">
                                <label class="filter-section-title">Status</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="new" id="statusNew" name="status">
                                        <label class="form-check-label" for="statusNew">New</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="ongoing" id="statusOngoing" name="status">
                                        <label class="form-check-label" for="statusOngoing">Ongoing</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="cancelled" id="statusCancelled" name="status">
                                        <label class="form-check-label" for="statusCancelled">Cancelled</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="complete" id="statusComplete" name="status">
                                        <label class="form-check-label" for="statusComplete">Complete</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Request Date -->
                            <div class="filter-section">
                                <label class="filter-section-title">Request Date</label>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="filter-date-group">
                                            <label class="form-label">From:</label>
                                            <input type="date" class="form-control" id="requestDateFrom" name="requestDateFrom">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="filter-date-group">
                                            <label class="form-label">To:</label>
                                            <input type="date" class="form-control" id="requestDateTo" name="requestDateTo">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Work Completion Date -->
                            <div class="filter-section">
                                <label class="filter-section-title">Work Completion Date</label>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="filter-date-group">
                                            <label class="form-label">From:</label>
                                            <input type="date" class="form-control" id="workCompletionDateFrom" name="workCompletionDateFrom">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="filter-date-group">
                                            <label class="form-label">To:</label>
                                            <input type="date" class="form-control" id="workCompletionDateTo" name="workCompletionDateTo">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Important Checklist - STATIC -->
                            <div class="filter-section">
                                <label class="filter-section-title">Important Checklist</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="permit_approved" id="checkPermit" name="checklist">
                                        <label class="form-check-label" for="checkPermit">Is Permit to Work approved?</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="hazardous_material" id="checkHazardous" name="checklist">
                                        <label class="form-check-label" for="checkHazardous">Hazardous material</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="isolation" id="checkIsolation" name="checklist">
                                        <label class="form-check-label" for="checkIsolation">Isolation</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="work_at_height" id="checkHeight" name="checklist">
                                        <label class="form-check-label" for="checkHeight">Work at height</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="lifting_operations" id="checkLifting" name="checklist">
                                        <label class="form-check-label" for="checkLifting">Lifting operations</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="equipment_safeguarding" id="checkEquipment" name="checklist">
                                        <label class="form-check-label" for="checkEquipment">Equipment safeguarding</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="jsa_required" id="checkJSA" name="checklist">
                                        <label class="form-check-label" for="checkJSA">Is JSA required?</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Feedback Type - STATIC -->
                            <div class="filter-section">
                                <label class="filter-section-title">Feedback Type</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="no_feedback" id="feedbackNone" name="feedback">
                                        <label class="form-check-label" for="feedbackNone">No Feedback</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="good" id="feedbackGood" name="feedback">
                                        <label class="form-check-label" for="feedbackGood">Good</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="need_improvement" id="feedbackImprovement" name="feedback">
                                        <label class="form-check-label" for="feedbackImprovement">Need Improvement</label>
                                    </div>
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="excellent" id="feedbackExcellent" name="feedback">
                                        <label class="form-check-label" for="feedbackExcellent">Excellent</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Has Sent Email - STATIC -->
                            <div class="filter-section">
                                <label class="filter-section-title">Has Sent Email</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="yes" id="emailYes" name="hasSentEmail">
                                        <label class="form-check-label" for="emailYes">Yes</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Show Deleted Data - STATIC -->
                            <div class="filter-section">
                                <label class="filter-section-title">Show Deleted Data</label>
                                <div class="filter-checkbox-group">
                                    <div class="filter-checkbox-item form-check">
                                        <input class="form-check-input" type="checkbox" value="yes" id="showDeleted" name="showDeleted">
                                        <label class="form-check-label" for="showDeleted">Yes</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-clear-filter" id="clearFiltersBtn">
                    <i class="ti ti-x me-1"></i>Clear All Filters
                </button>
                <button type="button" class="btn btn-primary" id="applyFiltersBtn">
                    <i class="ti ti-check me-1"></i>Apply Filters
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade modal-animate" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header no-divider">
                <div class="d-flex flex-row align-items-center text-danger">
                    <i class="ti ti-alert-octagon m-r-10" style="font-size: 20px"></i>
                    <span class="text-lg fw-semibold">Warning</span>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5>You are about to delete Work Request &mdash; WR-1234567</h5>
                <p>Are you sure you want to delete this Work Request? This action cannot be undone.</p>
            </div>
            <div class="modal-footer no-divider bg-gray-100">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-between gap-3">
                        <button type="button" class="btn btn-outline-secondary rounded-3 w-100 d-flex justify-content-center align-items-center" data-bs-dismiss="modal">
                            <i class="ti ti-x m-r-10"></i>
                            Cancel
                        </button>
                        <button type="button" class="btn btn-danger rounded-3 w-100 d-flex justify-content-center align-items-center">
                            <i class="ti ti-trash m-r-10"></i>
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            // Initialize popovers
            $('[data-bs-toggle="popover"]').popover({
                container: 'body',
                placement: 'top',
                trigger: 'hover'
            });

            // Delete Modal Animation
            var deleteModal = $('#deleteModal');
            deleteModal.on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var recipient = button.data('pc-animate');
                deleteModal.addClass('anim-' + recipient);
                if (recipient == 'let-me-in' || recipient == 'make-way' || recipient == 'slip-from-top') {
                    $('body').addClass('anim-' + recipient);
                }
            });

            deleteModal.on('hidden.bs.modal', function () {
                removeClassByPrefix(deleteModal, 'anim-');
                removeClassByPrefix($('body'), 'anim-');
            });

            function removeClassByPrefix(node, prefix) {
                node.removeClass(function (index, className) {
                    return (className.match(new RegExp('\\b' + prefix + '\\S+', 'g')) || []).join(' ');
                });
            }


            // Clear all filters
            $('#clearFiltersBtn').on('click', function() {
                $('#filterForm')[0].reset();
                $('#filterForm input[type="checkbox"]').prop('checked', false);
                $('#filterPropertyGroup').val('');
                $('#filterRoomZone').val('');
            });

            // Apply filters
            $('#applyFiltersBtn').on('click', function() {
                // Collect all filter values
                var filters = {
                    propertyGroup: $('#filterPropertyGroup').val(),
                    roomZone: $('#filterRoomZone').val(),
                    locations: $('input[name="locations"]:checked').map(function() { return this.value; }).get(),
                    serviceProviders: $('input[name="serviceProviders"]:checked').map(function() { return this.value; }).get(),
                    workCategories: $('input[name="workCategories"]:checked').map(function() { return this.value; }).get(),
                    otherCategories: $('input[name="otherCategories"]:checked').map(function() { return this.value; }).get(),
                    priorities: $('input[name="priorities"]:checked').map(function() { return this.value; }).get(),
                    statuses: $('input[name="statuses"]:checked').map(function() { return this.value; }).get(),
                    requestDateFrom: $('#requestDateFrom').val(),
                    requestDateTo: $('#requestDateTo').val(),
                    workCompletionDateFrom: $('#workCompletionDateFrom').val(),
                    workCompletionDateTo: $('#workCompletionDateTo').val(),
                    checklist: $('input[name="checklist"]:checked').map(function() { return this.value; }).get(),
                    feedback: $('input[name="feedback"]:checked').map(function() { return this.value; }).get(),
                    hasSentEmail: $('#emailYes').is(':checked'),
                    showDeleted: $('#showDeleted').is(':checked')
                };

                console.log('Applying filters:', filters);

                // TODO: Build query string and redirect OR make AJAX call to refresh table
                $('#filterModal').modal('hide');
            });

            // Main search button
            $('#searchButton').on('click', function() {
                var searchTerm = $('#mainSearchInput').val();
                console.log('Searching for:', searchTerm);
                // TODO: Implement search logic
            });

            // Clear search button
            $('#clearSearchButton').on('click', function() {
                $('#mainSearchInput').val('');
                console.log('Clearing search...');
                // TODO: Implement clear search logic - reload page without filters
            });
        });
    </script>
}
